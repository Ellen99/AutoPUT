/*
 *  Copyright 2001-2013 Stephen Colebourne
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
package org.joda.time;

import junit.framework.TestCase;
import junit.framework.TestSuite;

import org.joda.time.chrono.GregorianChronology;
import org.joda.time.tz.DateTimeZoneBuilder;
import org.junit.runner.RunWith;
import org.junit.experimental.theories.Theories;
import org.junit.experimental.theories.Theory;
import org.junit.experimental.theories.DataPoints;

/**
 * This class is a JUnit test for DateTimeZone.
 *
 * @author Stephen Colebourne
 */
public @RunWith(Theories.class) class AutoPutTest extends TestCase {

    public static void main(String[] args) {
        junit.textui.TestRunner.run(suite());
    }

    public static TestSuite suite() {
        return new TestSuite(TestDateTimeZoneCutover.class);
    }

    public TestDateTimeZoneCutover(String name) {
        super(name);
    }

    protected void setUp() throws Exception {
    }

    protected void tearDown() throws Exception {
    }

    //-----------------------------------------------------------------------
    //------------------------ Bug [1710316] --------------------------------
    //-----------------------------------------------------------------------
    // The behaviour of getOffsetFromLocal is defined in its javadoc
    // However, this definition doesn't work for all DateTimeField operations
    
    private void doTest_getOffsetFromLocal_Gaza(int days, int hour, int min, String expected) {
        DateTime dt = new DateTime(2007, 4, 1, hour, min, 0, 0, DateTimeZone.UTC).plusDays(days);
        int offset = MOCK_GAZA.getOffsetFromLocal(dt.getMillis());
        DateTime res = new DateTime(dt.getMillis() - offset, MOCK_GAZA);
        assertEquals(res.toString(), expected, res.toString());
    }

    private void doTest_getOffsetFromLocal_Turk(int days, int hour, int min, String expected, int expOffset) {
        DateTime dt = new DateTime(2007, 4, 1, hour, min, 0, 0, DateTimeZone.UTC).plusDays(days);
        int offset = MOCK_TURK.getOffsetFromLocal(dt.getMillis());
        assertEquals(expOffset * 3600000L, offset);
        DateTime res = new DateTime(dt.getMillis() - offset, MOCK_TURK);
        assertEquals(res.toString(), expected, res.toString());
    }

    @Theory
	public void autoPutTest(Fixture fixture) {
        doTest_getOffsetFromLocal(3, fixture._input[0], 1, 0, fixture._input[1], fixture._input[2], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[3], 1,30, fixture._input[4], fixture._input[5], ZONE_NEW_YORK);
        
        doTest_getOffsetFromLocal(3, fixture._input[6], 2, 0, fixture._input[7], fixture._input[8], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[9], 2,30, fixture._input[10], fixture._input[11], ZONE_NEW_YORK);
        
        doTest_getOffsetFromLocal(3, fixture._input[12], 3, 0, fixture._input[13], fixture._input[14], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[15], 3,30, fixture._input[16], fixture._input[17], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[18], 4, 0, fixture._input[19], fixture._input[20], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[21], 5, 0, fixture._input[22], fixture._input[23], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[24], 6, 0, fixture._input[25], fixture._input[26], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[27], 7, 0, fixture._input[28], fixture._input[29], ZONE_NEW_YORK);
        doTest_getOffsetFromLocal(3, fixture._input[30], 8, 0, fixture._input[31], fixture._input[32], ZONE_NEW_YORK);
    }

    

    //-----------------------------------------------------------------------
    //-----------------------------------------------------------------------
    //-----------------------------------------------------------------------

    

//    public void test_toDateMidnight_SaoPaolo() {
//        // RFE: 1684259
//        DateTimeZone zone = DateTimeZone.forID("America/Sao_Paulo");
//        LocalDate baseDate = new LocalDate(2006, 11, 5);
//        DateMidnight dm = baseDate.toDateMidnight(zone);
//        assertEquals("2006-11-05T00:00:00.000-03:00", dm.toString());
//        DateTime dt = baseDate.toDateTimeAtMidnight(zone);
//        assertEquals("2006-11-05T00:00:00.000-03:00", dt.toString());
//    }

    //-----------------------------------------------------------------------
    //-----------------------------------------------------------------------
    //-----------------------------------------------------------------------
    private void doTest_getOffsetFromLocal(int month, int day, int hour, int min, String expected, int expOffset, DateTimeZone zone) {
        doTest_getOffsetFromLocal(2007, month, day, hour, min, 0, 0, expected, expOffset, zone);
    }

    private void doTest_getOffsetFromLocal(int month, int day, int hour, int min, int sec, int milli, String expected, int expOffset, DateTimeZone zone) {
        doTest_getOffsetFromLocal(2007, month, day, hour, min, sec, milli, expected, expOffset, zone);
    }

    private void doTest_getOffsetFromLocal(int year, int month, int day, int hour, int min, String expected, int expOffset, DateTimeZone zone) {
        doTest_getOffsetFromLocal(year, month, day, hour, min, 0, 0, expected, expOffset, zone);
    }

    private void doTest_getOffsetFromLocal(int year, int month, int day, int hour, int min, int sec, int milli, String expected, int expOffset, DateTimeZone zone) {
        DateTime dt = new DateTime(year, month, day, hour, min, sec, milli, DateTimeZone.UTC);
        int offset = zone.getOffsetFromLocal(dt.getMillis());
        assertEquals(expOffset * 3600000L, offset);
        DateTime res = new DateTime(dt.getMillis() - offset, zone);
        assertEquals(res.toString(), expected, res.toString());
    }

	private static Object[] INPUT1 = { 11, "2007-03-11T01:00:00.000-05:00", -5, 11, "2007-03-11T01:30:00.000-05:00", -5,
			11, "2007-03-11T03:00:00.000-04:00", -5, 11, "2007-03-11T03:30:00.000-04:00", -5, 11,
			"2007-03-11T03:00:00.000-04:00", -4, 11, "2007-03-11T03:30:00.000-04:00", -4, 11,
			"2007-03-11T04:00:00.000-04:00", -4, 11, "2007-03-11T05:00:00.000-04:00", -4, 11,
			"2007-03-11T06:00:00.000-04:00", -4, 11, "2007-03-11T07:00:00.000-04:00", -4, 11,
			"2007-03-11T08:00:00.000-04:00", -4 };

	private static Object[] EXPECTED1 = null;

	private static Object[] INPUT2 = { 25, "2007-03-25T01:00:00.000+03:00", 3, 25, "2007-03-25T01:30:00.000+03:00", 3,
			25, "2007-03-25T03:00:00.000+04:00", 3, 25, "2007-03-25T03:30:00.000+04:00", 3, 25,
			"2007-03-25T03:00:00.000+04:00", 4, 25, "2007-03-25T03:30:00.000+04:00", 4, 25,
			"2007-03-25T04:00:00.000+04:00", 4, 25, "2007-03-25T05:00:00.000+04:00", 4, 25,
			"2007-03-25T06:00:00.000+04:00", 4, 25, "2007-03-25T07:00:00.000+04:00", 4, 25,
			"2007-03-25T08:00:00.000+04:00", 4 };

	private static Object[] EXPECTED2 = null;

	@DataPoints public static Fixture[] DATA={new Fixture(INPUT1,EXPECTED1),new Fixture(INPUT2,EXPECTED2)};

	public static class Fixture {
		private Object[] _input;
		private Object _expected;

		public Fixture(Object[] _input, Object _expected) {
			this._input = _input;
			this._expected = _expected;
		}
	}

}