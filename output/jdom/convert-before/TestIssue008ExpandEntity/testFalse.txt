package org.jdom2.test.cases.special;

import static org.junit.Assert.*;

import java.io.IOException;
import java.net.URL;

import org.jdom2.Document;
import org.jdom2.JDOMException;
import org.jdom2.input.SAXBuilder;
import org.jdom2.output.Format;
import org.jdom2.output.XMLOutputter;
import org.jdom2.test.util.FidoFetch;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameters;

@SuppressWarnings("javadoc")
public @RunWith(Parameterized.class) class TestIssue008ExpandEntity {
	
	private final void roundTrip(boolean expand, boolean validating, String encoding, String expect) {
		String docloc = "/" + this.getClass().getPackage().getName().replaceAll("\\.", "/") + "/TestIssue008.xml";
		URL docurl = FidoFetch.getFido().getURL(docloc);
		
		if (docurl == null) {
			throw new IllegalStateException("Unable to get resource " + docloc);
		}

		@SuppressWarnings("deprecation")
		SAXBuilder builder = new SAXBuilder(validating);
		//builder.setValidation(validating);
		builder.setExpandEntities(expand);
		Document doc = null;
		try {
			doc = builder.build(docurl);
		} catch (JDOMException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		if (doc == null) {
			fail("Unable to parse document, see output.");
		}
		
		Format fmt = Format.getCompactFormat();
		if (encoding != null) {
			fmt.setEncoding(encoding);
		}
		XMLOutputter xout = new XMLOutputter(fmt);
		
		String actual = xout.outputString(doc.getRootElement());
		assertEquals(expect, actual);
		
	}

	@Test
	public void testFalse() {
		roundTrip(_input[0], _input[1], null, _input[2]);
	}

	@Parameters public static Collection<Object[]> data(){return Arrays.asList(new Object[][]{{{false,false,"<doc>&minus;</doc>"},{}},{{true,false,"<doc>\u2212</doc>"},{}},{{false,true,"<doc>&minus;</doc>"},{}},{{true,true,"<doc>\u2212</doc>"},{}}});}

	private Object[] _input;
	private Object _expected;

	public AutoPUT(Object[] _input, Object _expected) {
		this._input = _input;
		this._expected = _expected;
	}


}